<footer>
  <div class="padding">
    <div class="row text-center">

    </div>
    <!-- Back to top button -->
<a id="back-home-button">
  <i class="fas fa-arrow-up"></i>
</a>
</footer>
<script>

  var nodes = document.querySelectorAll('.needs_to_be_rendered');

  // use render method to render nodes in real time
  timeago.render(nodes, 'vi');

  // cancel all real-time render task
  timeago.cancel();

  var numberNodes = document.querySelectorAll('.needs_to_format');


  // Format nodes number wit dots
  for (i = 0; i < numberNodes.length; i++) {
    numberNodes[i].innerHTML = numberNodes[i].innerHTML.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ".");
  }



  if ($(".visited-comics").length && ("undefined" != typeof Storage && void 0 !== localStorage["visited-comics"] && (H = JSON.parse(localStorage["visited-comics"])).length > 0)) {
    var titleHistory = "<div class='title-history'>" + "<h4>Lịch sử đọc truyện<a class='view-all' href='/lich-su'>tất cả></a></h4></div>";
    L = $("<div>").addClass("box darkBox"), P = $("<ul>").addClass("list-unstyled");
    var J = 0;
    for (b = H.length - 1; b >= 0; b--) {
      I = H[b], E = $("<li>").addClass("clearfix");
      var F = $("<div>").addClass("t-item");
      E.append(F);
      U = $("<a>").addClass("thumb").attr("title", I.name).attr("href", I.chapterUrl), B = $("<img>").addClass("lazy").attr("alt", I.name).attr("data-original", I.image).attr("src", I.image);
      U.append(B), F.append(U);
      _ = $("<h3>").addClass("t-title"), z = $("<a>").html(I.name).attr("href", I.chapterUrl);
      _.append(z), F.append(_);
      var q = $("<p>").addClass("chapter"),
        K = $("<a>").html("Đọc tiếp " + I.chapterName + ' <i class="fa fa-angle-double-right"></i>').attr("href", I.chapterUrl),
        X = $("<span>").addClass("view pull-right");
      $("<a>").addClass("visited-remove").attr("href", "#").data("id", I.id).html('<i class="fa fa-times"></i> Xóa').click(function (e) {
        return e.preventDefault(), V($(this)), !1
      }).appendTo(X);
      if (q.append(K).append(X), F.append(q), P.append(E), ++J > 2) break
    }
    L.append(P);
    $(".visited-comics").empty();
    $(".visited-comics").append(titleHistory);
    $(".visited-comics").append(L);

  }
  function V(e) {
    if ("undefined" != typeof Storage && void 0 !== localStorage["visited-comics"]) {
      var t = JSON.parse(localStorage["visited-comics"]),
        a = $(e).data("id");
      if (t.length > 0) {
        var r = t.map(function (e) {
          return e.id
        }).indexOf(a);
        r > -1 && (t.splice(r, 1), localStorage["visited-comics"] = JSON.stringify(t), $(e).parents(".item").remove(), $(e).parents("li").remove())
      }
    }
  }

  $('.xem-them').click(function () {
    $('.loadingGif').show();

    var skip = $('.item-truyen').length;

    $.ajax({
      type: 'post',
      data: {
        skip: skip
      },
      dataType: 'json',
      url: '/load-them-truyen',
      success: function (response) {
        if (response.status == 1) {
          var listTruyen = response.listTruyen;

          var errorJs = "javascript:this.src='/themes/home/images/404-avatar.png';";

          var html = '';
          var truyen;
          var baChapMoi;

          for (var i = 0; i < listTruyen.length; i++) {
            truyen = listTruyen[i];
            baChapMoi = listTruyen[i]['chap_moi_ra'];
            var A = $("<div>").addClass("col-md-3 col-6");
            var B = $("<div>").addClass("item-truyen text-left");
            var C = $("<figure>").addClass("clearfix");
            var D = $("<div>").addClass("image");
            var E = $("<a>").addClass("preview");
            E.attr("title", truyen.ten_truyen);
            E.attr("href", "/truyen-tranh/" + truyen.slug_truyen);
            var F = $("<img>").addClass("lazy");
            F.attr("src", "//images.weserv.nl/?url="+encodeURIComponent(truyen.hinh_truyen)+"&w=200");
            F.data("original", truyen.hinh_truyen);
            F.attr("style", "display: inline ;");

            var FF = $("<span>");
            FF.attr("style", "display:none");
            FF.attr("id", "hidden-ten-truyen");
            FF.text(truyen.ten_truyen);

            var FFF = $("<span>");
            FFF.attr("style", "display:none");
            FFF.attr("id", "hidden-the-loai");
            FFF.text(truyen.the_loai);

            var FFFF = $("<span>");
            FFFF.attr("style", "display:none");
            FFFF.attr("id", "hidden-luot-xem");
            FFFF.text(truyen.luot_xem);

            var FFFF = $("<span>");
            FFFF.attr("style", "display:none");
            FFFF.attr("id", "hidden-tac-gia");
            FFFF.text(truyen.tac_gia);

            var FFFFF = $("<span>");
            FFFFF.attr("style", "display:none");
            FFFFF.attr("id", "hidden-noi-dung");
            FFFFF.text(truyen.noi_dung);

            var G = $("<div>").addClass("view clearfix");
            var H = $("<span>").addClass("pull-left");
            var I1 = $("<i>").addClass("fa fa-eye");
            var I2 = $("<i>").addClass("fa fa-comment");
            var I3 = $("<i>").addClass("fa fa-heart");
            var J1 = $("<span>").addClass("needs_to_format");
            J1.text(listTruyen[i].luot_xem);
            var J2 = $("<span>").addClass("needs_to_format");
            J2.text(listTruyen[i].luot_danh_gia);
            var J3 = $("<span>").addClass("needs_to_format");
            J3.text(listTruyen[i].luot_theo_doi);
            //Figcaption
            var DF = $("<figcaption>");
            var DFH3 = $("<H3>");
            var DFH3A = $("<a>").addClass("jtip");
            DFH3A.text(listTruyen[i].ten_truyen);
            DFH3A.attr("href", "/truyen-tranh/" + listTruyen[i].slug_truyen);
            var DFUL = $("<ul>");

            for (var j = 0; j < baChapMoi.length; j++) {
              var DFULLI = $("<li>").addClass("chapter clearfix");
              var DFULLIA = $("<a>").addClass("sts");
              DFULLIA.attr("title", "Chapter " + baChapMoi[baChapMoi.length - (j + 1)].ten_chuong);
              DFULLIA.attr("href", "/truyen-tranh/" + truyen.ten_truyen);
              DFULLIA.text("Chapter " + baChapMoi[baChapMoi.length - (j + 1)].ten_chuong);
              var DFULLII = $("<i>").addClass("time needs_to_be_rendered");
              DFULLII.attr("datetime", baChapMoi[baChapMoi.length - (j + 1)].thoi_gian_tao);
              timeago.render(DFULLII, 'vi');
              DFULLI.append(DFULLIA);
              DFULLI.append(DFULLII);

              DFUL.append(DFULLI)
            }

            H.append(I1);
            H.append(J1);
            H.append(I2);
            H.append(J2);
            H.append(I3);
            H.append(J3);
            G.append(H);
            E.append(F);
            E.append(FF);
            E.append(FFF);
            E.append(FFFF);
            E.append(FFFFF);
            E.append(G);
            D.append(E);
            C.append(D);
            DFH3.append(DFH3A);
            DF.append(DFH3);
            DF.append(DFUL);
            C.append(DF);
            B.append(C);
            A.append(B);
            $(".truyen-item-home").append(A);
          }
        }

        $('.loadingGif').hide();
      }
    });
  });
  /*tooltip*/
  /* CONFIG */
  xOffset = 10;
  yOffset = 30;
  /* END CONFIG */
  $("a.preview").hover(function (e) {
    this.t = this.title;
    this.title = "";
    var imageHover = this.querySelector("img.lazy").src;
    var theLoaiTruyen = this.querySelector("span#hidden-the-loai").innerText;
    var luotXemTruyen = this.querySelector("span#hidden-luot-xem").innerText;
    var tacGiaTruyen = this.querySelector("span#hidden-tac-gia").innerText;
    var noiDungTruyen = this.querySelector("span#hidden-noi-dung").innerText;
    var c = (this.t != "") ? "<br/>" + this.t : "";
    var toolTipBox = "<div id='preview'>";
    toolTipBox += "<div class='tooltip-box'>";
    toolTipBox += "<div class='img-tooltip'>";
    toolTipBox += "<img src='" + imageHover + "' alt='Image preview' />";
    toolTipBox += "</div>"
    toolTipBox += "<div class='info-tooltip'>";
    toolTipBox += "<p><label>Thể loại:</label>" + theLoaiTruyen;
    toolTipBox += "</p>";
    toolTipBox += "<p><label>Lượt xem:</label>" + luotXemTruyen;
    toolTipBox += "</p>";
    toolTipBox += "<p><label>Tác giả:</label>" + tacGiaTruyen;
    toolTipBox += "</p>";
    toolTipBox += "</div>";
    toolTipBox += "<div class='clearfix'>";
    toolTipBox += "</div>";
    toolTipBox += "<div>";
    toolTipBox += "<p><label>Nội dung:</label>" + noiDungTruyen;
    toolTipBox += "</p>";
    toolTipBox += "</div>";
    toolTipBox += "</div>";
    toolTipBox += "</div>";
    $("body").append(toolTipBox);
    $("#preview")
      .css("top", (e.pageY - xOffset) + "px")
      .css("left", (e.pageX + yOffset) + "px")
      .fadeIn("fast");
  },
    function () {
      this.title = this.t;
      $("#preview").remove();
    });
  $("a.preview").mousemove(function (e) {
    $("#preview")
      .css("top", (e.pageY - xOffset) + "px")
      .css("left", (e.pageX + yOffset) + "px");
  });
  /*loadmenu*/
  var elementPerCol = theLoai.size/4;
  var lastElementCol = theLoai.size - (Math.round(elementPerCol) * 3);
  var col1 = elementPerCol;
  var col2 = elementPerCol;
  var col3 = elementPerCol;
  var col4 = lastElementCol;

  /*col menu 1*/
  var a = $("<div>").addClass("col-sm-3");
  var b = $("<ul>").addClass("multi-column-dropdown");
      for (var j = 0; j < Math.round(col1); j++) {
          var c = $("<li>");
          var d = $("<a>").addClass("dropdown-item");
          d.attr("href","/tim-truyen/"+theLoai.get(j)[0]);
          d.text(theLoai.get(j)[1]);
          c.append(d);
          b.append(c);
      }
  a.append(b);
  $(".multi-column .row").append(a);

  /*col menu 2*/
  var a = $("<div>").addClass("col-sm-3");
  var b = $("<ul>").addClass("multi-column-dropdown");
      for (var j = 12; j < Math.round(col1) + Math.round(col2); j++) {
          var c = $("<li>");
          var d = $("<a>").addClass("dropdown-item");
          d.attr("href","/tim-truyen/"+theLoai.get(j)[0]);
          d.text(theLoai.get(j)[1]);
          c.append(d);
          b.append(c);
      }
  a.append(b);
  $(".multi-column .row").append(a);

  /*col menu 3*/
  var a = $("<div>").addClass("col-sm-3");
  var b = $("<ul>").addClass("multi-column-dropdown");
      for (var j = 24; j < Math.round(col1) + Math.round(col2) + Math.round(col3) ; j++) {
          var c = $("<li>");
          var d = $("<a>").addClass("dropdown-item");
          d.attr("href","/tim-truyen/"+theLoai.get(j)[0]);
          d.text(theLoai.get(j)[1]);
          c.append(d);
          b.append(c);
      }
  a.append(b);
  $(".multi-column .row").append(a);

  /*col menu 4*/
  var a = $("<div>").addClass("col-sm-3");
  var b = $("<ul>").addClass("multi-column-dropdown");
      for (var j = 36; j < Math.round(col1) + Math.round(col2) + Math.round(col3)+  Math.round(col4); j++) {
          var c = $("<li>");
          var d = $("<a>").addClass("dropdown-item");
          d.attr("href","/tim-truyen/"+theLoai.get(j)[0]);
          d.text(theLoai.get(j)[1]);
          c.append(d);
          b.append(c);
      }
  a.append(b);
  $(".multi-column .row").append(a);
  /*endloadmenu*/
  /*loadTheLoaiTruyen*/
  var allTheLoai = theLoai.size;
  for (var i = 0; i < allTheLoai; i++) {
    var a = $("<a>");
    var b = $("<div>").addClass("col-md-6");
    a.attr("href", "/tim-truyen/"+theLoai.get(i)[0]);
    a.attr("title", theLoai.get(i)[1]);
    a.text(theLoai.get(i)[1]);
    b.append(a);
    $(".list-cat .row").append(b);
  }

  /*endLoadTheLoaiTruyen*/
  /*loadfootertheloai*/
  var allTheLoai = theLoai.size;
  for (var i = 0; i < allTheLoai; i++) {
    var a = $("<a>");
    var b = $("<div>").addClass("col-md-3 col-6");
    a.attr("href", "/tim-truyen/"+theLoai.get(i)[0]);
    a.attr("title", theLoai.get(i)[1]);
    a.text(theLoai.get(i)[1]);
    b.append(a);
    $("footer .row").append(b);
  }
  /* endloadfootertheloai */
  /* backtohome*/
  var btn = $('#back-home-button');

$(window).scroll(function() {
  if ($(window).scrollTop() > 300) {
    btn.addClass('show');
  } else {
    btn.removeClass('show');
  }
});

btn.on('click', function(e) {
  e.preventDefault();
  $('html, body').animate({scrollTop:0}, '300');
});

  /*endbacktohome*/
  /*endtooltip*/
  var lazyLoadInstance = new LazyLoad({
    elements_selector: ".lazy-hinh"
  });
</script>
